<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --bg:#f8fafc;
  --card:#ffffff;
  --panel:#e0f2fe;
  --text:#0f172a;
  --btn:#93c5fd;
  --btnText:#020617;
  --top1:#60a5fa;
  --top2:#38bdf8;
  --danger:#ef4444;
}
.dark{
  --bg:#020617;
  --card:#0f172a;
  --panel:#1e293b;
  --text:#e5e7eb;
  --btn:#334155;
  --btnText:#e5e7eb;
  --top1:#1e293b;
  --top2:#020617;
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:var(--bg);color:var(--text);transition:.3s}

/* LOGIN */
.login{
  height:100vh;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(135deg,#60a5fa,#38bdf8)
}
.login-box{
  background:var(--card);padding:40px;border-radius:20px;
  width:90%;max-width:360px
}
.login-box input{
  width:100%;padding:14px;margin:10px 0;
  border-radius:10px;border:1px solid #cbd5f5
}
.login-box button{
  width:100%;padding:14px;border:none;border-radius:12px;
  background:#60a5fa;color:white;font-size:18px
}

/* SIDEBAR */
.sidebar{
  position:fixed;top:0;left:0;height:100%;width:240px;
  background:var(--panel);padding:20px;
  transform:translateX(-100%);transition:.3s;z-index:20
}
.sidebar.show{transform:translateX(0)}
.sidebar button{
  width:100%;padding:12px;margin:8px 0;border:none;
  border-radius:12px;background:var(--btn);
  color:var(--btnText);font-size:16px;text-align:left
}

/* TOGGLE */
.toggle{
  margin-top:20px;padding:12px;border-radius:12px;
  background:var(--btn);display:flex;justify-content:space-between
}

/* OVERLAY */
#overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.4);
  opacity:0;pointer-events:none;transition:.3s;z-index:15
}
#overlay.show{opacity:1;pointer-events:auto}

.hidden{display:none}

/* TOPBAR */
.topbar{
  display:flex;align-items:center;gap:10px;
  padding:14px 16px;
  background:linear-gradient(135deg,var(--top1),var(--top2));
  color:white
}
.menu{font-size:26px;cursor:pointer}
.topbar h3{flex:1;text-align:center;margin:0}

/* PAGES */
.page{display:none;padding:20px}
.page.active{display:block}

/* CARDS */
.card{
  background:var(--card);padding:22px;border-radius:20px;
  margin-bottom:20px
}
.badge{
  background:var(--danger);color:white;
  padding:2px 8px;border-radius:20px;font-size:12px
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="loginPage">
  <div class="login-box">
    <h2>Admin Login</h2>
    <input id="adminId" placeholder="Admin ID">
    <input id="adminPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <button onclick="openPage('home')">üè† Home</button>
  <button onclick="openPage('pending')">
    ‚è≥ Pending <span class="badge" id="pendingCount">0</span>
  </button>
  <button onclick="openPage('approved')">‚úÖ Approved</button>
  <button onclick="logout()">üö™ Logout</button>

  <div class="toggle">
    <span>üåô Dark Mode</span>
    <input type="checkbox" id="darkToggle">
  </div>
</div>
<div id="overlay"></div>

<!-- APP -->
<div class="hidden" id="app">
  <div class="topbar">
    <span class="menu" onclick="toggleSidebar()">‚ò∞</span>
    <h3 id="title">Home</h3>
  </div>

  <div class="page" id="home">
    <div class="card">
      <h2>Hello, Aayush üëã</h2>
      <p>Admin Dashboard</p>
      <p><b>Date:</b> <span id="date"></span></p>
      <p><b>Time:</b> <span id="time"></span></p>
    </div>
  </div>

  <div class="page" id="pending"></div>

  <div class="page" id="approved"></div>
</div>

<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import {
  getDatabase, ref, onValue, set, remove
} from
"https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

/* FIREBASE */
const firebaseConfig={
  apiKey:"AIzaSyAht7TWN8NlbICl0VbEIuc19Mri7oPlXvc",
  databaseURL:"https://home-automation-89830-default-rtdb.firebaseio.com"
};
const fbApp=initializeApp(firebaseConfig);
const db=getDatabase(fbApp);

/* DOM */
const loginPage=document.getElementById("loginPage");
const app=document.getElementById("app");
const sidebar=document.getElementById("sidebar");
const overlay=document.getElementById("overlay");
const title=document.getElementById("title");
const darkToggle=document.getElementById("darkToggle");
const pendingCount=document.getElementById("pendingCount");
const pendingPage=document.getElementById("pending");
const approvedPage=document.getElementById("approved");

/* LOGIN */
window.login=()=>{
  if(adminId.value==="aayush" && adminPass.value==="Aayush@1982"){
    loginPage.classList.add("hidden");
    app.classList.remove("hidden");
    openPage("home");
  }else alert("Invalid login");
};
window.logout=()=>location.reload();

/* NAV */
window.openPage=id=>{
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  title.innerText=id.charAt(0).toUpperCase()+id.slice(1);
  sidebar.classList.remove("show");
  overlay.classList.remove("show");
};

/* SIDEBAR */
window.toggleSidebar=()=>{
  sidebar.classList.toggle("show");
  overlay.classList.toggle("show");
};
overlay.onclick=toggleSidebar;

/* DARK MODE */
if(localStorage.theme==="dark"){
  document.body.classList.add("dark");
  darkToggle.checked=true;
}
darkToggle.onchange=()=>{
  document.body.classList.toggle("dark");
  localStorage.theme=document.body.classList.contains("dark")?"dark":"light";
};

/* TIME */
setInterval(()=>{
  const now=new Date();
  date.innerText=now.toLocaleDateString();
  time.innerText=now.toLocaleTimeString();
},1000);

/* PENDING REQUESTS */
onValue(ref(db,"requests/pending"),snap=>{
  pendingPage.innerHTML=`<div class="card"><h3>Pending Requests</h3></div>`;
  let count=0;
  snap.forEach(c=>{
    count++;
    const d=c.val();
    pendingPage.innerHTML+=`
      <div class="card">
        <b>Name:</b> ${d.name}<br>
        <b>Phone:</b> ${d.phone}<br>
        <b>Time:</b> ${d.time}<br><br>
        <button onclick="approveUser('${c.key}')">Approve</button>
      </div>`;
  });
  pendingCount.innerText=count;
});

/* APPROVE */
window.approveUser=id=>{
  const pRef=ref(db,"requests/pending/"+id);
  const aRef=ref(db,"requests/approved/"+id);
  onValue(pRef,s=>{
    if(s.exists()){
      set(aRef,s.val());
      remove(pRef);
    }
  },{once:true});
};

/* APPROVED USERS */
onValue(ref(db,"requests/approved"),snap=>{
  approvedPage.innerHTML=`<div class="card"><h3>Approved Users</h3></div>`;
  snap.forEach(c=>{
    const d=c.val();
    approvedPage.innerHTML+=`
      <div class="card">
        <b>Name:</b> ${d.name}<br>
        <b>Phone:</b> ${d.phone}<br>
        <b>Approved At:</b> ${d.time}<br><br>
        <button onclick="removeUser('${c.key}')">Remove</button>
      </div>`;
  });
});

/* REMOVE */
window.removeUser=id=>{
  remove(ref(db,"requests/approved/"+id));
};
</script>

</body>
</html>
